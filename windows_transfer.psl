# --- User Configuration ---
# Please modify the path below to the root directory of the XML files you want to process
$targetDirectory = ".\Database\ModAssetLists"
# --- Configuration End ---


# Check if the path exists
if (-not (Test-Path -Path $targetDirectory -PathType Container)) {
    Write-Host "Error: Directory '$targetDirectory' does not exist." -ForegroundColor Red
    # Pause the script so the user can see the error message
    Read-Host "Press Enter to exit"
    exit
}

Write-Host "Start processing directory: '$targetDirectory'..." -ForegroundColor Green

# Use Get-ChildItem to recursively find all .xml files
Get-ChildItem -Path $targetDirectory -Filter *.xml -Recurse | ForEach-Object {
    $file = $_
    Write-Host "  Processing file: $($file.FullName)"
    
    try {
        # Read the file content as an XML object
        [xml]$xmlContent = Get-Content -Path $file.FullName
        
        # Use XPath to find all <File> nodes
        $fileNodes = $xmlContent.SelectNodes("//File")
        
        if ($fileNodes.Count -eq 0) {
            # If no File nodes are found, skip
            return
        }
        
        # Iterate through all found nodes and modify the text
        foreach ($node in $fileNodes) {
            if ($node.InnerText) {
                $node.InnerText = $node.InnerText.Replace('/', '\')
            }
        }
        
        # Save the modified XML file
        $xmlContent.Save($file.FullName)
    }
    catch {
        Write-Host "  An error occurred while processing file $($file.FullName): $_" -ForegroundColor Red
    }
}

Write-Host "Processing complete." -ForegroundColor Green
Read-Host "Press Enter to exit"